<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-cc72b2d9-e0ef-4690-b417-0f49f1e38d5d"></attachment><h1>了解 Block</h1><p>打开&nbsp;<a href="https://scratch.mit.edu/projects/editor/" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;">Scratch3.0</a>&nbsp;查看左侧的积木，会发现每个分类的积木颜色、形状、组成各有异同。他们形状不同代表了什么区别呢？一个积木块上面有又一些不一样的元素组成，这些元素是什么？我怎么能定义一个我自己的积木呢？</p><p>这些问题接下来会一一说明。</p><h3><br></h3><h3>Block 的形状与功能</h3><p>UI 形状类型功能<a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/command.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/command.png"></a>命令类型 Command执行一条命令<a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/number.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/number.png"></a>数值或字符串类型 Number or String读取一个数值或字符串<a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/boolean.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/boolean.png"></a>布尔类型 Boolean返回 True 或 False<a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/hat.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/hat.png"></a>事件类型 Event (也被叫做 帽子块 hat)监听一个事件<a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/condition.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/condition.png"></a>条件类型 Condition根据条件的结果，执行不同的分支<a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/button.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/button.png"></a>按钮 Button就是按钮的功能，可以添加一个点击后的回调事件</p><p>我们会看到有的积木上也有一些形状跟数值、字符串和布尔类型的积木形状类似，而我们也可以把他们嵌入到对应形状的积木里，就像我们也可以把命令型的积木嵌入到条件类型的积木里面一样。如图：</p><p><a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/blocks.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/blocks.png"></a></p><p>这是因为这些位置也是一种特殊的 block，被称为 shadow block，与 XML 对应的有些积木里有 shadow 标签，如：</p><pre class="ql-syntax" spellcheck="false">&lt;block type="motion_movesteps"&gt;
    &lt;value name="STEPS"&gt;
        &lt;shadow type="math_number"&gt;
            &lt;field name="NUM"&gt;10&lt;/field&gt;
        &lt;/shadow&gt;
    &lt;/value&gt;
&lt;/block&gt;
</pre><p>这种 shadow block 是作为一个参数呈现在另一个 block 中的，它接受与他相同返回值类型的 block 覆盖它。</p><h3><br></h3><h3>Block 的组成元素</h3><p>block 是通过 XML 代码来定义结构的：</p><ul><li>block 标签：积木，type 是他的标识符（也被称作 opcode），需要与他的定义名称相对应。在 mainWorkspace 中将积木转化成 XML （可以常看上一章内容）你还会发现他有一些其他属性，比如 id、x、y 等。</li><li>value 标签：是指 block 的一个参数，参数的名字就是 value 标签的 name 属性，也会和积木定义的参数相对应。</li><li>shadow 标签：阴影积木，type 属性是引用的已定义的其他 block 的 type。</li><li>field 标签：block 的最小组成单元，name 属性值需要时已经定义好的 Field 类型。在 XML 中 field 标签可以不写，除非需要修改在积木上显示的默认值。</li></ul><h3><br></h3><h3>Block 的定义</h3><p>继续以 motion_movesteps 为例：</p><pre class="ql-syntax" spellcheck="false">import ScratchBlocks from 'scratch-blocks';
// 将 'motion_movesteps' 添加到 ScratchBlocks.Blocks 对象中，这个对象包含了所有积木的定义
ScratchBlocks.Blocks['motion_movesteps'] = {
    // 积木初始化时调用的方法
    init: function() {
        // 积木的 json 配置
        this.jsonInit({
            // 积木标识符，如果和 ScratchBlocks.Blocks['motion_movesteps'] 中的一致，可以省略不写
            "type": "motion_movesteps",
            // 积木的文案，1% 是参数占位符，和 args0 数组中参数对应
            "message0": '移动 %1',
            // 积木的参数，必须是数组，可以为空数组，
            "args0": [
                {
                    // 参数类型，input_ 开头表示包含了一个 shadow block
                    // 需要在 xml 中指明 shadow block 的 type
                    "type": "input_value",
                    // 参数的名称
                    "name": "STEPS"
                }
            ],
            // 积木所属的分类，对应 xml 中 category 标签的 id
            "category": 'motion',
            // 积木继承项，数组中的字符串是已经定义好的扩展，使用扩展属性可以减少重复的配置
            // 可以在 ScratchBlocks.Extensions 对象中查看所有定义的扩展，也可以自己定义扩展。
            // colours_motion 表示 motion 积木的颜色
            // shape_statement 表示积木的形状
            "extensions": ["colours_motion", "shape_statement"]
        });
    }
};
</pre><p>除了&nbsp;<code style="background-color: rgba(27, 31, 35, 0.05);">message0</code>、&nbsp;<code style="background-color: rgba(27, 31, 35, 0.05);">args0</code>&nbsp;还可以有&nbsp;<code style="background-color: rgba(27, 31, 35, 0.05);">message1</code>、&nbsp;<code style="background-color: rgba(27, 31, 35, 0.05);">args1</code>等，表明这个积木是多行的，如 if-else 的定义：</p><p><a href="https://github.com/Micircle/scratch3.0-note/blob/master/scratch-blocks/blocks/condition.png" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;"><img src="https://github.com/Micircle/scratch3.0-note/raw/master/scratch-blocks/blocks/condition.png"></a></p><pre class="ql-syntax" spellcheck="false">import ScratchBlocks from 'scratch-blocks';
ScratchBlocks.Blocks['control_if_else'] = {
    init: function() {
        this.jsonInit({
            "type": "control_if_else",
            // 积木如果要支持多语言，就需要用 ScratchBlocks.Msg 对象来设置 message
            "message0": ScratchBlocks.Msg.CONTROL_IF, // zh: 如果 1% 那么
            "message1": "%1",
            "message2": ScratchBlocks.Msg.CONTROL_ELSE, // zh: 否则
            "message3": "%1",
            "args0": [
                {
                    "type": "input_value",
                    "name": "CONDITION",
                    "check": "Boolean"
                }
            ],
            "args1": [
                {
                    "type": "input_statement",
                    "name": "SUBSTACK"
                }
            ],
            "args3": [
                {
                    "type": "input_statement",
                    "name": "SUBSTACK2"
                }
            ],
            // 分类也用 ScratchBlocks.Categories 对象来设置，避免不一致
            "category": ScratchBlocks.Categories.control,
            "extensions": ["colours_control", "shape_statement"]
        });
    }
};
</pre><p>如果想为积木设置其他的颜色那么可以在 json 中配置&nbsp;<code style="background-color: rgba(27, 31, 35, 0.05);">colour, colourSecondary, colourTertiary</code>&nbsp;属性。</p><p>如果想自定义积木的形状可以配置&nbsp;<code style="background-color: rgba(27, 31, 35, 0.05);">output, outputShape, previousStatement, nextStatement</code>&nbsp;属性。</p><p>积木中 args 的 type 属性可以是已定义的 input 类型或 field 类型，input 类型的参数是对应了一个 shadow block，通常在 UI 上可以被相同形状的积木覆盖。</p><p>常用到的 fields 和 inputs：</p><ul><li>Fields:</li><li class="ql-indent-1">field_dropdown: 下拉列表</li><li class="ql-indent-1">field_checkbox: 勾选框</li><li class="ql-indent-1">field_colour: 颜色</li><li class="ql-indent-1">field_number: 数字输入</li><li class="ql-indent-1">field_angle: 角度选择</li><li class="ql-indent-1">field_variable: 变量</li><li class="ql-indent-1">field_date: 日期</li><li class="ql-indent-1">field_label: 标签文本，通常根据 message 直接生成</li><li class="ql-indent-1">field_image: 图片文本</li><li>Inputs:</li><li class="ql-indent-1">input_value：可被相同形状的积木覆盖的参数，根据&nbsp;<code style="background-color: rgba(27, 31, 35, 0.05);">"check": "Boolean", "String", "Number"&nbsp;</code>的不同，形状不同</li><li class="ql-indent-1">input_statement：可以连接命令类型积木</li></ul><p>更为详细的可以查看官方的文档&nbsp;<a href="https://google-developers.appspot.com/blockly/guides/create-custom-blocks/define-blocks" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;">Define Blocks</a>。</p><h3><br></h3><h3>示例</h3><ul><li><a href="https://github.com/Micircle/scratch3.0-note/blob/master/src/examples/define-block.html" target="_blank" style="color: rgb(3, 102, 214); background-color: initial;">定义一个分类的积木</a></li></ul><p><br></p>