<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-b3081e43-51f8-4173-a173-9660684b2ba3"></attachment><p>scratch-blocks是scratch-gui依赖的一个基本模块。它的作用是生成gui界面上的blocks。（有关scratch-blocks的方法可以看我上一篇博客《scratch3.0二次开发之scratch-blocks的免编译修改方法》）。blocks的作用是通过拖曳的方法组成blocks堆块，点击greenflag控件，舞台区（stage)会有相应的变化。</p><p>scratch-gui的blocks的生成文件在scratch-blocks\blocks_vertical里。</p><p><br></p><p>blocks几种形状</p><p>blocks块的形状有以下几种：</p><p><br></p><p>块	形状名称</p><p>	shape_statement</p><p>	shape_hat</p><p>	shape_end</p><p>	shape_statement</p><p>	output_boolean</p><p>	output_number</p><p>	output_string</p><p>一个blocks块的定义</p><p>比如一个右转多少度的块</p><p><br></p><p>定义块的代码：</p><p><br></p><p>Blockly.Blocks['motion_turnright'] = {</p><p>&nbsp;/**</p><p>&nbsp;* Block to turn right.</p><p>&nbsp;* @this Blockly.Block</p><p>&nbsp;&nbsp;*/</p><p>&nbsp;init: function() {</p><p>&nbsp;&nbsp;this.jsonInit({</p><p>&nbsp;&nbsp;&nbsp;"message0": “右转 %1 %2 度”,</p><p>&nbsp;&nbsp;&nbsp;"args0": [</p><p>&nbsp;&nbsp;&nbsp;&nbsp;{</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type": "field_image",</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"src": Blockly.mainWorkspace.options.pathToMedia + "rotate-right.svg",</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"width": 24,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"height": 24</p><p>&nbsp;&nbsp;&nbsp;&nbsp;},</p><p>&nbsp;&nbsp;&nbsp;&nbsp;{</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type": "input_value",</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name": "DEGREES"</p><p>&nbsp;&nbsp;&nbsp;&nbsp;}</p><p>&nbsp;&nbsp;&nbsp;],</p><p>&nbsp;&nbsp;&nbsp;"category": Blockly.Categories.motion,//块归属的类，这里是运动类。</p><p>&nbsp;&nbsp;&nbsp;"extensions": ["colours_motion", "shape_statement"]</p><p>&nbsp;&nbsp;});</p><p>&nbsp;}</p><p>};</p><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>“message0“：表示块里显示的字符串，%1,%2表示块里的字段field,块里有1个field是%1，有两个field是按先后顺序设为%1,%2,以此类推，</p><p>”args0”:里面的数组元素对应上面设置的field,args0[0]对应%1，args0[1]对应%2，…。每个元素对象表示设置了的field的类型。</p><p><br></p><p>“extensions”："colours_motion"设置块的颜色，"shape_statement"设置了块的形状；</p><p><br></p><p>blocks块的使用</p><p>定义好的block块，使用的时候要把加到xml文件里，文件地址:scratch-gui\src\lib\make-toolbox-xml.js,找到对应的类，这里是motion.</p><p><br></p><p>&lt;block type="motion_turnright"&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value name="DEGREES"&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;shadow type="math_number"&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;field name="NUM"&gt;15&lt;/field&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/shadow&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/value&gt;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/block&gt;</p><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>motion_turnright 这是刚定义好的块。value 标签中的name，表示变量名，在scratch-vm里面会用到，shadow标签这段表示预先设置的值，也是预先设置的块。去掉value这段代码</p><p><br></p><p>&lt;block type="motion_turnright"&gt; &lt;/block&gt;</p><p>1</p><p>它显示成这样：</p><p><br></p><p><br></p><p>scratch-blocks的编译</p><p>scratch-blocks修改后的文件，只有编译压缩后才能生效。但是按照官方的方法，windows下很难编译成功。如果是定义blocks块，可以参考上篇博客里介绍的方法《scratch3.0二次开发之scratch-blocks的免编译修改方法》</p><p>————————————————</p><p>版权声明：本文为CSDN博主「取个昵称就那么难」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</p><p>原文链接：https://blog.csdn.net/jyht1226/article/details/102764411</p><p><br></p>